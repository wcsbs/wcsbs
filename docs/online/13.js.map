{"version":3,"sources":["webpack:///src/components/DownloadReport.vue","webpack:///src/views/ReportManagement.vue","webpack:///./src/components/DownloadReport.vue?2386","webpack:///./src/views/ReportManagement.vue?95e0","webpack:///./src/components/DownloadReport.vue","webpack:///./src/components/DownloadReport.vue?0e4e","webpack:///./src/components/DownloadReport.vue?93e9","webpack:///./src/views/ReportManagement.vue","webpack:///./src/views/ReportManagement.vue?ecab","webpack:///./src/views/ReportManagement.vue?ab2b"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,wBADA;AAEA;AACA;AADA,GAFA;AAKA,8BACA,yDACA,gBADA,EAEA,WAFA,EAGA,YAHA,EAIA,cAJA,EAKA,eALA,EADA,CALA;AAcA;AACA;AAAA;AAAA;AAAA,KADA;AAEA,qBAFA;AAGA,sBAHA;AAIA;AAJA,GAdA;AAoBA;AACA;AACA;AADA;AAGA,GAxBA;AAyBA;AACA,eADA,yBACA;AACA;AACA,yEACA,WADA,GAEA,KAFA,CAEA,GAFA,EAEA,CAFA;AAGA;AACA,KAPA;AAQA,aARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA,6BATA,GASA,IATA;AAUA,yBAVA,GAUA,cAVA;AAWA,uBAXA,GAWA,iBAXA;AAYA,0BAZA,GAYA,eACA,eADA,GAEA,yBAdA;AAeA,uBAfA,GAeA,YAfA;AAgBA,0BAhBA,GAgBA,UACA,SADA,GAEA,YACA,WADA,GAEA,eApBA;AAqBA,gCArBA,GAqBA,2BArBA;AAsBA,0BAtBA,GAsBA,kDAtBA;AAuBA,gEACA,OADA,0BACA,UADA;AAKA,qBA5BA,GA4BA,CA5BA;;AAAA;AAAA,sBA6BA,SA7BA;AAAA;AAAA;AAAA;;AAAA;AAAA,uBA8BA;AACA,kCADA;AAEA,wCAFA;AAGA,wCAHA;AAIA,oDAJA;AAKA;AALA,mBAOA,IAPA,CAOA;AACA;AACA;;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AAAA;AAAA;AACA;;AACA;AACA,iBAzBA,EA0BA,KA1BA,CA0BA;AACA;AACA;AACA,iBA7BA,CA9BA;;AAAA;AA8BA,wBA9BA;;AAAA,qBA6DA,uBA7DA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,sBAkEA,oBAlEA;AAAA;AAAA;AAAA;;AAmEA;AACA;AAAA;AAAA;AApEA;;AAAA;AAwEA;AAxEA;AAAA;;AAAA;AAAA,iDA2EA,QA3EA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA6EA,iBA7EA,2BA6EA;AACA;AACA,KA/EA;AAgFA,kBAhFA,4BAgFA;AACA;AACA;AAlFA;AAzBA,G;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACqBA;AACA;AACA;AACA;AACA;AAEA;AACA,0BADA;AAEA;AACA,4EADA;AAEA;AAFA,GAFA;AAMA,8BACA,yDACA,gBADA,EAEA,WAFA,EAGA,YAHA,EAIA,cAJA,EAKA,eALA,EADA,CANA;AAeA,kBAfA,4BAeA,EAfA,EAeA,IAfA,EAeA,IAfA,EAeA;AACA;AACA;AACA,KAFA;AAGA;AAnBA,G;;;;;;;;;;;;AClDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACpCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,6CAA6C;AAC7E;AACA;AACA;AACA;AACA,yCAAyC,SAAS,uBAAuB,EAAE;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAAA;AAA6F;AAC3B;AACL;;;AAG7D;AAC0F;AAC1F,gBAAgB,2GAAU;AAC1B,EAAE,oFAAM;AACR,EAAE,yFAAM;AACR,EAAE,kGAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,IAAU;AACd,YAAY,mBAAO,CAAC,wGAA4G;AAChI,cAAc,mBAAO,CAAC,uDAAK;AAC3B;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,sBAAsB,+HAAqD,EAAE;AAAA;AAC7E;AACA,gBAAgB,yFAAM;AACtB,yBAAyB,kGAAe;AACxC,OAAO;AACP,KAAK;AACL;AACA;AACA;AACe,gF;;;;;;;;;;;;ACtCf;AAAA;AAAA,wCAA2R,CAAgB,+UAAG,EAAC,C;;;;;;;;;;;;ACA/S;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAA+F;AAC3B;AACL;;;AAG/D;AAC0F;AAC1F,gBAAgB,2GAAU;AAC1B,EAAE,sFAAM;AACR,EAAE,2FAAM;AACR,EAAE,oGAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,IAAU;AACd,YAAY,mBAAO,CAAC,wGAA4G;AAChI,cAAc,mBAAO,CAAC,uDAAK;AAC3B;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,sBAAsB,8HAAuD,EAAE;AAAA;AAC/E;AACA,gBAAgB,2FAAM;AACtB,yBAAyB,oGAAe;AACxC,OAAO;AACP,KAAK;AACL;AACA;AACA;AACe,gF;;;;;;;;;;;;ACtCf;AAAA;AAAA,wCAA6R,CAAgB,iVAAG,EAAC,C;;;;;;;;;;;;ACAjT;AAAA;AAAA;AAAA;AAAA;AAAA","file":"13.js","sourcesContent":["<template>\n  <div>\n    <JsonExcel\n      class=\"btn btn-info btn-block\"\n      :worksheet=\"worksheet\"\n      :fetch=\"fetchData\"\n      :before-generate=\"startDownload\"\n      :before-finish=\"finishDownload\"\n      :name=\"getFilename()\"\n    >\n      {{ downloading ? `${worksheet}下载中...` : `下载${worksheet}` }}\n    </JsonExcel>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from \"vuex\";\nimport Parse from \"parse\";\nimport JsonExcel from \"vue-json-excel\";\nimport Vue from \"vue\";\nimport { v4 as uuidv4 } from \"uuid\";\nVue.component(\"JsonExcel\", JsonExcel);\n\nexport default {\n  name: \"DownloadReport\",\n  components: {\n    JsonExcel\n  },\n  computed: {\n    ...mapGetters([\n      \"isLoadingStats\",\n      \"classInfo\",\n      \"classTeams\",\n      \"isClassAdmin\",\n      \"isSystemAdmin\"\n    ])\n  },\n  props: {\n    classTeam: { type: Object, required: false },\n    worksheet: String,\n    practiceId: String,\n    forSelf: Boolean\n  },\n  data: function() {\n    return {\n      downloading: false\n    };\n  },\n  methods: {\n    getFilename() {\n      const date = new Date();\n      const timestamp = new Date(date.toString().split(\"GMT\")[0] + \" UTC\")\n        .toISOString()\n        .split(\".\")[0];\n      return `${this.worksheet}_${timestamp}.xls`;\n    },\n    async fetchData() {\n      const thisComponent = this;\n      const classTeam = this.classTeam;\n      const classId = this.classInfo.id;\n      const practiceId = this.forSelf\n        ? this.practiceId\n        : this.classInfo.practiceId;\n      const forSelf = this.forSelf;\n      const classTeams = forSelf\n        ? undefined\n        : classTeam\n        ? [classTeam]\n        : this.classTeams;\n      const monthlyTotalOnly = !classTeam && !this.forSelf;\n      const reportUuid = uuidv4();\n      console.log(\n        `generateReport - forSelf: ${forSelf} reportUuid: ${reportUuid}`\n      );\n\n      var response,\n        retry = 3;\n      while (retry > 0) {\n        response = await Parse.Cloud.run(\"class:generateReport\", {\n          classId,\n          classTeams,\n          practiceId,\n          monthlyTotalOnly,\n          reportUuid\n        })\n          .then(result => {\n            // console.log(`generateReport - result: ${JSON.stringify(result)}`);\n            console.log(`generateReport - #result: ${result.length}`);\n            if (!forSelf) {\n              var lastTeamIndex = -1;\n              for (var i = 0; i < result.length; i++) {\n                const record = result[i];\n                const index = parseInt(record[\"组别\"]);\n                if (index != lastTeamIndex) {\n                  record[\"组员\"] = `组长${record[\"组员\"]}`;\n                  lastTeamIndex = index;\n                }\n              }\n            }\n            if (!result || result.length == 0) {\n              result = [{ 错误: \"您不是正式学员，不能下载统计报表！\" }];\n            }\n            return result;\n          })\n          .catch(e => {\n            console.log(`error in generateReport: ${e}`);\n            return e;\n          });\n\n        if (Array.isArray(response)) {\n          break;\n        }\n\n        //{\"message\":\"XMLHttpRequest failed: \\\"Unable to connect to the Parse API\\\"\",\"code\":100}\n        if (response.code != 100) {\n          thisComponent.$dialog.alert(`error in generateReport: ${response}`);\n          response = [{ 错误: `下载失败：${JSON.stringify(response)}` }];\n          break;\n        }\n\n        retry--;\n      }\n\n      return response;\n    },\n    startDownload() {\n      this.downloading = true;\n    },\n    finishDownload() {\n      this.downloading = false;\n    }\n  }\n};\n</script>\n","<template>\n  <div>\n    <div v-if=\"isLoadingStats\">正在获取统计信息...</div>\n    <div v-else>\n      <h3>\n        {{ classInfo.name }} --\n        {{\n          !classInfo.practiceId\n            ? \"出席统计\"\n            : `${classInfo.practiceName}实修统计`\n        }}\n      </h3>\n      <div v-if=\"classInfo.canDownloadClassReport\">\n        <DownloadReport\n          :worksheet=\"\n            !classInfo.practiceId\n              ? '中组出席统计'\n              : `中组${classInfo.practiceName}统计`\n          \"\n        />\n        <hr />\n      </div>\n      <div\n        v-for=\"(classTeam, index) in classTeams\"\n        :key=\"classTeam.id + classTeam.name + index\"\n      >\n        <div v-if=\"index > 0 && classTeam.members.length > 0\">\n          <ClassTeam :classTeam=\"classTeam\" />\n          <DownloadReport\n            :classTeam=\"classTeam\"\n            :worksheet=\"\n              !classInfo.practiceId\n                ? `${classTeam.name}出席统计`\n                : `${classTeam.name}${classInfo.practiceName}统计`\n            \"\n          />\n          <hr />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from \"vuex\";\nimport ClassTeam from \"@/components/ClassTeam\";\nimport DownloadReport from \"@/components/DownloadReport\";\nimport { FETCH_STATS } from \"../store/actions.type\";\nimport store from \"@/store\";\n\nexport default {\n  name: \"ReportManagement\",\n  components: {\n    ClassTeam,\n    DownloadReport\n  },\n  computed: {\n    ...mapGetters([\n      \"isLoadingStats\",\n      \"classInfo\",\n      \"classTeams\",\n      \"isClassAdmin\",\n      \"isSystemAdmin\"\n    ])\n  },\n  beforeRouteEnter(to, from, next) {\n    store.dispatch(FETCH_STATS, to.params).then(() => {\n      next();\n    });\n  }\n};\n</script>\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    [\n      _c(\n        \"JsonExcel\",\n        {\n          staticClass: \"btn btn-info btn-block\",\n          attrs: {\n            worksheet: _vm.worksheet,\n            fetch: _vm.fetchData,\n            \"before-generate\": _vm.startDownload,\n            \"before-finish\": _vm.finishDownload,\n            name: _vm.getFilename()\n          }\n        },\n        [\n          _vm._v(\n            \"\\n    \" +\n              _vm._s(\n                _vm.downloading\n                  ? _vm.worksheet + \"下载中...\"\n                  : \"下载\" + _vm.worksheet\n              ) +\n              \"\\n  \"\n          )\n        ]\n      )\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\"div\", [\n    _vm.isLoadingStats\n      ? _c(\"div\", [_vm._v(\"正在获取统计信息...\")])\n      : _c(\n          \"div\",\n          [\n            _c(\"h3\", [\n              _vm._v(\n                \"\\n      \" +\n                  _vm._s(_vm.classInfo.name) +\n                  \" --\\n      \" +\n                  _vm._s(\n                    !_vm.classInfo.practiceId\n                      ? \"出席统计\"\n                      : _vm.classInfo.practiceName + \"实修统计\"\n                  ) +\n                  \"\\n    \"\n              )\n            ]),\n            _vm.classInfo.canDownloadClassReport\n              ? _c(\n                  \"div\",\n                  [\n                    _c(\"DownloadReport\", {\n                      attrs: {\n                        worksheet: !_vm.classInfo.practiceId\n                          ? \"中组出席统计\"\n                          : \"中组\" + _vm.classInfo.practiceName + \"统计\"\n                      }\n                    }),\n                    _c(\"hr\")\n                  ],\n                  1\n                )\n              : _vm._e(),\n            _vm._l(_vm.classTeams, function(classTeam, index) {\n              return _c(\"div\", { key: classTeam.id + classTeam.name + index }, [\n                index > 0 && classTeam.members.length > 0\n                  ? _c(\n                      \"div\",\n                      [\n                        _c(\"ClassTeam\", { attrs: { classTeam: classTeam } }),\n                        _c(\"DownloadReport\", {\n                          attrs: {\n                            classTeam: classTeam,\n                            worksheet: !_vm.classInfo.practiceId\n                              ? classTeam.name + \"出席统计\"\n                              : \"\" +\n                                classTeam.name +\n                                _vm.classInfo.practiceName +\n                                \"统计\"\n                          }\n                        }),\n                        _c(\"hr\")\n                      ],\n                      1\n                    )\n                  : _vm._e()\n              ])\n            })\n          ],\n          2\n        )\n  ])\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./DownloadReport.vue?vue&type=template&id=56adc40c&\"\nimport script from \"./DownloadReport.vue?vue&type=script&lang=js&\"\nexport * from \"./DownloadReport.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/donghao/Documents/code/buddha/wcsbs/code/wcsbs-online/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('56adc40c')) {\n      api.createRecord('56adc40c', component.options)\n    } else {\n      api.reload('56adc40c', component.options)\n    }\n    module.hot.accept(\"./DownloadReport.vue?vue&type=template&id=56adc40c&\", function () {\n      api.rerender('56adc40c', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/components/DownloadReport.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DownloadReport.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DownloadReport.vue?vue&type=script&lang=js&\"","export * from \"-!../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"7e0fe40c-vue-loader-template\\\"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DownloadReport.vue?vue&type=template&id=56adc40c&\"","import { render, staticRenderFns } from \"./ReportManagement.vue?vue&type=template&id=0bf06551&\"\nimport script from \"./ReportManagement.vue?vue&type=script&lang=js&\"\nexport * from \"./ReportManagement.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/donghao/Documents/code/buddha/wcsbs/code/wcsbs-online/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('0bf06551')) {\n      api.createRecord('0bf06551', component.options)\n    } else {\n      api.reload('0bf06551', component.options)\n    }\n    module.hot.accept(\"./ReportManagement.vue?vue&type=template&id=0bf06551&\", function () {\n      api.rerender('0bf06551', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/ReportManagement.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ReportManagement.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ReportManagement.vue?vue&type=script&lang=js&\"","export * from \"-!../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"7e0fe40c-vue-loader-template\\\"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ReportManagement.vue?vue&type=template&id=0bf06551&\""],"sourceRoot":""}