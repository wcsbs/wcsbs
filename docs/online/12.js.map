{"version":3,"sources":["webpack:///src/components/DownloadReport.vue","webpack:///src/views/CountList.vue","webpack:///./src/components/DownloadReport.vue?173d","webpack:///./src/views/CountList.vue?a3a5","webpack:///./src/components/DownloadReport.vue","webpack:///./src/components/DownloadReport.vue?0e4e","webpack:///./src/components/DownloadReport.vue?93e9","webpack:///./src/views/CountList.vue","webpack:///./src/views/CountList.vue?e674","webpack:///./src/views/CountList.vue?b0ab"],"names":[],"mappings":"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","file":"12.js","sourcesContent":["<template>\n  <div>\n    <JsonExcel\n      class=\"btn btn-info btn-block\"\n      :worksheet=\"worksheet\"\n      :fetch=\"fetchData\"\n      :before-generate=\"startDownload\"\n      :before-finish=\"finishDownload\"\n      :name=\"getFilename()\"\n    >\n      {{ downloading ? `${worksheet}下载中...` : `下载${worksheet}` }}\n    </JsonExcel>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from \"vuex\";\nimport Parse from \"parse\";\nimport JsonExcel from \"vue-json-excel\";\nimport Vue from \"vue\";\nVue.component(\"JsonExcel\", JsonExcel);\n\nexport default {\n  name: \"DownloadReport\",\n  components: {\n    JsonExcel\n  },\n  computed: {\n    ...mapGetters([\n      \"isLoadingStats\",\n      \"classInfo\",\n      \"classTeams\",\n      \"isClassAdmin\",\n      \"isSystemAdmin\"\n    ])\n  },\n  props: {\n    classTeam: { type: Object, required: false },\n    worksheet: String,\n    practiceId: String,\n    forSelf: Boolean\n  },\n  data: function() {\n    return {\n      downloading: false\n    };\n  },\n  methods: {\n    getFilename() {\n      const date = new Date();\n      const timestamp = new Date(date.toString().split(\"GMT\")[0] + \" UTC\")\n        .toISOString()\n        .split(\".\")[0];\n      return `${this.worksheet}_${timestamp}.xls`;\n    },\n    async fetchData() {\n      const thisComponent = this;\n      const classTeam = this.classTeam;\n      const classId = this.classInfo.id;\n      const practiceId = this.forSelf\n        ? this.practiceId\n        : this.classInfo.practiceId;\n      const forSelf = this.forSelf;\n      const classTeams = forSelf\n        ? undefined\n        : classTeam\n        ? [classTeam]\n        : this.classTeams;\n      const monthlyTotalOnly = !classTeam && !this.forSelf;\n      console.log(`generateReport - forSelf: ${forSelf}`);\n\n      return await Parse.Cloud.run(\"class:generateReport\", {\n        classId,\n        classTeams,\n        practiceId,\n        monthlyTotalOnly\n      })\n        .then(result => {\n          // console.log(`generateReport - result: ${JSON.stringify(result)}`);\n          console.log(`generateReport - #result: ${result.length}`);\n          if (!forSelf) {\n            var lastTeamIndex = -1;\n            for (var i = 0; i < result.length; i++) {\n              const record = result[i];\n              const index = parseInt(record[\"组别\"]);\n              if (index != lastTeamIndex) {\n                record[\"组员\"] = `组长${record[\"组员\"]}`;\n                lastTeamIndex = index;\n              }\n            }\n          }\n          if (result.length == 0) {\n            result = [{ 错误: \"您不是正式学员，不能下载统计报表！\" }];\n          }\n          return result;\n        })\n        .catch(e => {\n          console.log(`error in generateReport: ${e}`);\n          thisComponent.$dialog.alert(`error in generateReport: ${e}`);\n          return e;\n        });\n    },\n    startDownload() {\n      this.downloading = true;\n    },\n    finishDownload() {\n      this.downloading = false;\n    }\n  }\n};\n</script>\n","<template>\n  <div v-if=\"isLoadingPracticeCounts\" class=\"classSession-preview\">\n    正在获取报数记录...\n  </div>\n  <div v-else>\n    <Practice\n      :practice=\"practiceInfo.practice\"\n      :latestPracticeCount=\"buildLatestPracticeCount()\"\n      :practiceCounts=\"practiceInfo.counts\"\n      :practiceSubmodules=\"practiceInfo.practiceSubmodules\"\n      :practiceSessions=\"practiceInfo.practiceSessions\"\n      :users=\"practiceInfo.users\"\n      :forAdmin=\"practiceInfo.forAdmin\"\n    />\n  </div>\n</template>\n\n<script>\nimport store from \"@/store\";\nimport { FETCH_PRACTICE_COUNTS } from \"../store/actions.type\";\nimport { mapGetters } from \"vuex\";\nimport Practice from \"@/components/Practice\";\n\nexport default {\n  name: \"CountList\",\n  components: {\n    Practice\n  },\n  computed: {\n    ...mapGetters([\"isLoadingPracticeCounts\", \"practiceInfo\"])\n  },\n  beforeRouteEnter(to, from, next) {\n    const practiceId = to.params.practiceId;\n    const forAdmin = to.params.forAdmin;\n    console.log(`forAdmin: ${forAdmin} practiceId: ${practiceId}`);\n\n    store.dispatch(FETCH_PRACTICE_COUNTS, to.params).then(() => {\n      next();\n    });\n  },\n  methods: {\n    buildLatestPracticeCount() {\n      var latestPracticeCount = {};\n      if (this.practiceInfo.counts[0]) {\n        if (this.practiceInfo.forAdmin) {\n          latestPracticeCount.reportedAt = new Date();\n          latestPracticeCount.accumulatedCount = 0;\n          for (var i = 0; i < this.practiceInfo.counts.length; i++) {\n            latestPracticeCount.accumulatedCount += this.practiceInfo.counts[\n              i\n            ].get(\"count\");\n          }\n        } else {\n          latestPracticeCount = {\n            count: this.practiceInfo.counts[0].get(\"count\"),\n            reportedAt: this.practiceInfo.counts[0].get(\"reportedAt\"),\n            accumulatedCount: this.practiceInfo.counts[\n              this.practiceInfo.counts.length - 1\n            ].get(\"count\")\n          };\n        }\n      }\n      return latestPracticeCount;\n    }\n  },\n  mounted() {\n    //this.$forceUpdate();\n  }\n};\n</script>\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    [\n      _c(\n        \"JsonExcel\",\n        {\n          staticClass: \"btn btn-info btn-block\",\n          attrs: {\n            worksheet: _vm.worksheet,\n            fetch: _vm.fetchData,\n            \"before-generate\": _vm.startDownload,\n            \"before-finish\": _vm.finishDownload,\n            name: _vm.getFilename()\n          }\n        },\n        [\n          _vm._v(\n            \"\\n    \" +\n              _vm._s(\n                _vm.downloading\n                  ? _vm.worksheet + \"下载中...\"\n                  : \"下载\" + _vm.worksheet\n              ) +\n              \"\\n  \"\n          )\n        ]\n      )\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _vm.isLoadingPracticeCounts\n    ? _c(\"div\", { staticClass: \"classSession-preview\" }, [\n        _vm._v(\"\\n  正在获取报数记录...\\n\")\n      ])\n    : _c(\n        \"div\",\n        [\n          _c(\"Practice\", {\n            attrs: {\n              practice: _vm.practiceInfo.practice,\n              latestPracticeCount: _vm.buildLatestPracticeCount(),\n              practiceCounts: _vm.practiceInfo.counts,\n              practiceSubmodules: _vm.practiceInfo.practiceSubmodules,\n              practiceSessions: _vm.practiceInfo.practiceSessions,\n              users: _vm.practiceInfo.users,\n              forAdmin: _vm.practiceInfo.forAdmin\n            }\n          })\n        ],\n        1\n      )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./DownloadReport.vue?vue&type=template&id=56adc40c&\"\nimport script from \"./DownloadReport.vue?vue&type=script&lang=js&\"\nexport * from \"./DownloadReport.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/donghao/Documents/code/buddha/wcsbs/code/wcsbs-online/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('56adc40c')) {\n      api.createRecord('56adc40c', component.options)\n    } else {\n      api.reload('56adc40c', component.options)\n    }\n    module.hot.accept(\"./DownloadReport.vue?vue&type=template&id=56adc40c&\", function () {\n      api.rerender('56adc40c', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/components/DownloadReport.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DownloadReport.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DownloadReport.vue?vue&type=script&lang=js&\"","export * from \"-!../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"1d050412-vue-loader-template\\\"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DownloadReport.vue?vue&type=template&id=56adc40c&\"","import { render, staticRenderFns } from \"./CountList.vue?vue&type=template&id=663f2f03&\"\nimport script from \"./CountList.vue?vue&type=script&lang=js&\"\nexport * from \"./CountList.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/donghao/Documents/code/buddha/wcsbs/code/wcsbs-online/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('663f2f03')) {\n      api.createRecord('663f2f03', component.options)\n    } else {\n      api.reload('663f2f03', component.options)\n    }\n    module.hot.accept(\"./CountList.vue?vue&type=template&id=663f2f03&\", function () {\n      api.rerender('663f2f03', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/CountList.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CountList.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CountList.vue?vue&type=script&lang=js&\"","export * from \"-!../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"1d050412-vue-loader-template\\\"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CountList.vue?vue&type=template&id=663f2f03&\""],"sourceRoot":""}