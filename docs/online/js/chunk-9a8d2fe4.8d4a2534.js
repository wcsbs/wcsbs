(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9a8d2fe4"],{"2c634":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.editing?s("b-form",{on:{submit:t.onSubmit,reset:t.onReset}},[s("h4",[t._v(t._s(this.session.creating?"创建新课":t.session.name))]),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"选择日期："}},[s("v-date-picker",{attrs:{locale:"zh-CN","input-props":{readonly:!0}},model:{value:t.session.scheduledAt,callback:function(e){t.$set(t.session,"scheduledAt",e)},expression:"session.scheduledAt"}}),s("b-input-group-append",[t.session.creating?t._e():s("b-button",{attrs:{type:"reset",variant:"warning"}},[s("b-icon",{attrs:{icon:"x-circle"}})],1),s("b-button",{attrs:{type:"submit",variant:"success"}},[s("b-icon",{attrs:{icon:"check-circle"}})],1)],1)],1),t.moduleDropdownOptions.length>1?s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"选择模块："}},[s("b-form-select",{attrs:{options:t.moduleDropdownOptions},on:{change:t.refreshUI},model:{value:t.session.moduleId,callback:function(e){t.$set(t.session,"moduleId",e)},expression:"session.moduleId"}})],1):t._e(),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"选子模块："}},[s("b-form-select",{attrs:{options:t.submoduleDropdownOptions},model:{value:t.session.submoduleId,callback:function(e){t.$set(t.session,"submoduleId",e)},expression:"session.submoduleId"}}),s("b-input-group-append",[t.canAddSubmodule?s("b-button",{attrs:{variant:"warning"},on:{click:function(e){return t.addSubmodule()}}},[t._v("加入上课内容")]):t._e()],1)],1),t._l(t.session.submodules,(function(e,n){return s("b-input-group",{key:e.id+n,staticClass:"mt-3",attrs:{prepend:"上课内容："}},[s("b-form-input",{attrs:{readonly:"",value:"("+(n+1)+") "+e.name}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"warning"},on:{click:function(e){return t.removeSubmodule(n)}}},[t._v("删除")])],1)],1)})),t.session.submodules.length>0?s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"上课名称："}},[s("b-form-input",{model:{value:t.session.name,callback:function(e){t.$set(t.session,"name",e)},expression:"session.name"}})],1):t._e(),s("b-form-textarea",{attrs:{placeholder:"输入上课通知",rows:"8","max-rows":"20"},model:{value:t.session.description,callback:function(e){t.$set(t.session,"description",e)},expression:"session.description"}})],2):s("b-card",{staticClass:"text-center",attrs:{header:t.session.name}},[s("b-card-text",[s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"上课时间："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.scheduledAtLocalDateTimeString,callback:function(e){t.$set(t.session,"scheduledAtLocalDateTimeString",e)},expression:"session.scheduledAtLocalDateTimeString"}}),s("b-input-group-append",[t.forApplication||!t.classInfo||t.session.creating||!t.isClassAdmin&&!t.isTeachingAssistant?t._e():s("b-button",{attrs:{variant:"warning"},on:{click:t.editSession}},[t._v("修改")])],1)],1),1==t.sessionDetails.submodules.length?s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"课前学习："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.materialState,callback:function(e){t.$set(t.session,"materialState",e)},expression:"session.materialState"}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"info",href:t.sessionDetails.submodules[0].url,target:"_blank"}},[s("b-icon",{attrs:{icon:"book"}})],1)],1)],1):t._l(t.sessionDetails.submodules,(function(e,n){return s("div",{key:e.id+n},[s("b-link",{attrs:{href:e.url,target:"_blank"}},[t._v(t._s("("+(n+1)+") "+e.name))]),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"课前学习："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.materialState,callback:function(e){t.$set(t.session,"materialState",e)},expression:"session.materialState"}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"info",href:e.url,target:"_blank"}},[s("b-icon",{attrs:{icon:"book"}})],1)],1)],1)],1)})),t.session.forApplication?t._e():s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"上课出勤："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.attendanceState,callback:function(e){t.$set(t.session,"attendanceState",e)},expression:"session.attendanceState"}}),s("b-input-group-append",[t.needToShowAttendanceButton()?s("b-button",{attrs:{variant:"warning"},on:{click:function(e){return t.updateAttendance()}}},[t._v(t._s(t.attendanceButtonName()))]):t._e(),s("b-button",{attrs:{variant:"info"},on:{click:function(e){t.session.showDescription=!t.session.showDescription}}},[t.session.showDescription?s("b-icon",{attrs:{icon:"chevron-double-up"}}):s("b-icon",{attrs:{icon:"chevron-double-down"}})],1)],1)],1),t.session.showDescription?s("b-form-textarea",{attrs:{placeholder:"",rows:"8","max-rows":"20",readonly:""},model:{value:t.session.description,callback:function(e){t.$set(t.session,"description",e)},expression:"session.description"}}):t._e()],2)],1)],1)},o=[],a=(s("8e6e"),s("ac6a"),s("456d"),s("6762"),s("2fdb"),s("55dd"),s("7f7f"),s("bd86")),i=s("bf48"),r=s.n(i),c=s("2f62");function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function l(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(Object(s),!0).forEach((function(e){Object(a["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var u={name:"ClassSession",props:{classSession:{type:Object,required:!0},sessionDetails:{type:Object,required:!1},classInfo:{type:Object,required:!1},newSessions:{type:Array,required:!1},forApplication:Boolean,forAdmin:Boolean},data:function(){return{session:this.classSession.dummy?{creating:!0,editing:!0,submodules:[]}:this.initSession(),moduleDropdownOptions:[],submoduleDropdownOptions:[],editing:this.classSession.dummy,canAddSubmodule:!1}},computed:l({},Object(c["b"])(["isClassAdmin","isTeachingAssistant","isStudent"])),mounted:function(){this.refreshUI()},methods:{initSession:function(){return{id:this.classSession.id,forApplication:this.classInfo?this.classInfo.forApplication:this.forApplication,name:this.classSession.get("name"),submodules:[].concat(this.sessionDetails.submodules),description:this.classSession.get("description"),scheduledAt:this.classSession.get("scheduledAt"),scheduledAtLocalDateTimeString:this.toLocalDateTimeString(this.classSession.get("scheduledAt")),showDescription:!1,attendanceState:this.toAttendanceStateString(this.sessionDetails),materialState:this.toMaterialStateString(this.sessionDetails,0)}},refreshUI:function(){var t=this;if(this.moduleDropdownOptions=[],this.submoduleDropdownOptions=[],this.editing){this.moduleDropdownOptions=this.classInfo.modules.map((function(t){return{value:t.id,text:t.name}}));for(var e,s=this.session,n=0;n<this.classInfo.modules.length;n++)if(e=this.classInfo.modules[n],!s.moduleId||s.moduleId==e.id)break;if(s.moduleId||(s.moduleId=e.id),console.log("refreshUI - selectedModule: ".concat(e.name)),this.submoduleDropdownOptions=this.submoduleDropdownOptions.concat(e.newSubmodules),!this.classSession.dummy)for(n=0;n<this.sessionDetails.submodules.length;n++){var o=this.sessionDetails.submodules[n];o.moduleId==e.id&&this.submoduleDropdownOptions.push(o)}var a=function(){var s=t.session.submodules[n];s.moduleId==e.id&&(t.submoduleDropdownOptions=t.submoduleDropdownOptions.filter((function(t){return t.id!=s.id})))};for(n=0;n<this.session.submodules.length;n++)a();this.submoduleDropdownOptions.length>0?(this.submoduleDropdownOptions.sort((function(t,e){var s=t.index,n=e.index;return s>n?1:n>s?-1:0})),this.session.submoduleId=this.submoduleDropdownOptions[0].id,console.log("refreshUI - selectedSubmodule: ".concat(this.submoduleDropdownOptions[0].name)),this.canAddSubmodule=!0):this.canAddSubmodule=!1,this.submoduleDropdownOptions=this.submoduleDropdownOptions.map((function(t){return{value:t.id,text:t.name}}))}},addSubmodule:function(){var t,e=this.session;console.log("addSubmodule - moduleId: ".concat(e.moduleId," submoduleId: ").concat(e.submoduleId));for(var s=0;s<this.classInfo.modules.length;s++)if(t=this.classInfo.modules[s],!e.moduleId||e.moduleId==t.id)break;for(s=0;s<t.newSubmodules.length;s++){var n=t.newSubmodules[s];if(n.id==e.submoduleId){e.submodules.push(n),e.name||(e.name=n.name);break}}this.refreshUI()},removeSubmodule:function(t){this.session.submodules.splice(t,1),this.refreshUI()},toLocalDateTimeString:function(t){var e={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString("zh-CN",e)},toLocalDateString:function(t){var e={year:"numeric",month:"short",day:"numeric"};return t.toLocaleDateString("zh-CN",e)},needToShowAttendanceButton:function(){return this.isStudent&&!this.forAdmin&&!this.forApplication},toAttendanceStateString:function(t){if(t){if("number"==typeof t.attendance.attendance)return"".concat(t.attendance.attendance,"人已上课");if(t.attendance.onLeave)return"已请假";if(1==t.attendance.attendance)return"已上课";if(0==t.attendance.attendance&&void 0==t.attendance.onLeave)return"未上课"}return"未报考勤"},toMaterialStateString:function(t,e){if(this.forApplication)return"请在课前看完传承/法本";var s="未看传承",n="未看法本";if(t&&t.submodules[e].studyRecord){var o=t.submodules[e].studyRecord;"number"==typeof o.lineage?s="".concat(o.lineage,"人已看传承"):o.lineage&&(s="已看传承"),"number"==typeof o.textbook?n="".concat(o.textbook,"人已看法本"):o.textbook&&(n="已看法本")}return"".concat(s,"/").concat(n)},attendanceButtonName:function(){var t=new Date;return t<this.classSession.get("scheduledAt")?this.sessionDetails.attendance.onLeave?"取消请假":"我要请假":void 0!=this.sessionDetails.attendance.attendance?"我要改考勤":"我要报考勤"},updateAttendance:function(){var t=new Date,e="确认",s=this.sessionDetails.attendance;t<this.classSession.get("scheduledAt")?s.onLeave?(s.onLeave=!1,e+="取消请假"):(s.onLeave=!0,s.attendance=!1,e+="请假"):s.attendance?(s.attendance=!1,e+="没有上课"):(s.attendance=!0,e+="已上课");var n=this.classSession.id,o={okText:"确认",cancelText:"取消",loader:!0},a={title:this.session.name,body:e+"?"},i=this;this.$dialog.confirm(a,o).then((function(t){r.a.Cloud.run("home:updateAttendanceV2",{sessionId:n,attendance:s}).then((function(e){console.log("updateAttendanceV2 - result: ".concat(JSON.stringify(e))),void 0!=e.attendance.onLeave&&(i.sessionDetails.attendance.onLeave=e.attendance.onLeave),void 0!=e.attendance.attendance&&(i.sessionDetails.attendance.attendance=e.attendance.attendance),i.session.attendanceState=i.toAttendanceStateString(i.sessionDetails),t.close()})).catch((function(e){console.log("error in updateAttendanceV2: ".concat(e)),t.close(),i.$dialog.alert("error in updateAttendance: ".concat(e))}))})).catch((function(t){console.log("error: ".concat(t))}))},editSession:function(){this.session=this.initSession(),this.editing=!0,this.refreshUI()},onReset:function(t){t.preventDefault(),this.session=this.initSession(),this.editing=!1},onSubmit:function(t){t.preventDefault();var e=this.session;if(!e.scheduledAt||e.submodules.length<1)this.$dialog.alert("请输入上课时间和内容！");else{var s={okText:"确认",cancelText:"取消",loader:!0},n={title:this.classInfo.name,body:"".concat(e.creating?"创建新课":"修改"," 《").concat(e.name,"》 @ ").concat(this.toLocalDateString(e.scheduledAt),"？")},o=new Date(e.scheduledAt);o.setHours(e.submodules[0].url.includes("rpsxl")?9:14),e.scheduledAt=o,e.classId=this.classInfo.id;var a=this;this.$dialog.confirm(n,s).then((function(t){r.a.Cloud.run("class:updateClassSessionV2",{session:e}).then((function(e){console.log("updateClassSession - result: ".concat(JSON.stringify(e))),t.close(),window.location.reload()})).catch((function(e){console.log("error in updateClassSession: ".concat(JSON.stringify(e))),t.close(),a.$dialog.alert("error in updateClassSession: ".concat(e))}))})).catch((function(t){console.log("error: ".concat(t))}))}}}},p=u,h=s("2877"),b=Object(h["a"])(p,n,o,!1,null,null,null);e["a"]=b.exports},"2f21":function(t,e,s){"use strict";var n=s("79e5");t.exports=function(t,e){return!!t&&n((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},"55dd":function(t,e,s){"use strict";var n=s("5ca1"),o=s("d8e8"),a=s("4bf8"),i=s("79e5"),r=[].sort,c=[1,2,3];n(n.P+n.F*(i((function(){c.sort(void 0)}))||!i((function(){c.sort(null)}))||!s("2f21")(r)),"Array",{sort:function(t){return void 0===t?r.call(a(this)):r.call(a(this),o(t))}})},"60b6":function(t,e,s){"use strict";var n=s("c87c"),o=s.n(n);o.a},bb51:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isLoadingDashboards?s("div",[t._v("\n    正在获取主页数据...\n  ")]):s("div",[s("b-tabs",{attrs:{pills:"","content-class":"mt-3",align:"center"}},[t.home.studentDashboard?s("b-tab",{attrs:{title:t.studentDashboardTitle(),"title-item-class":"mytab",acitve:""}},[s("StudentDashboard",{attrs:{dashboard:t.home.studentDashboard}})],1):t._e(),t.home.classAdminDashboard?s("b-tab",{attrs:{title:t.classAdminDashboardTitle(),"title-item-class":"mytab",acitve:""}},[s("AdminDashboard",{attrs:{dashboard:t.home.classAdminDashboard}})],1):t._e(),t.home.systemAdminDashboard?s("b-tab",{attrs:{title:"学会全部课程","title-item-class":"mytab",acitve:""}},[s("AdminDashboard",{attrs:{dashboard:t.home.systemAdminDashboard}})],1):t._e()],1)],1)])},o=[],a=(s("8e6e"),s("ac6a"),s("456d"),s("f559"),s("bd86")),i=(s("7f7f"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"user-preview"},[0===t.dashboard.enrolledClasses.length?s("div",{staticClass:"user-preview"},[t._v("\n    您还没有参加任何佛学课程！\n  ")]):t._l(t.dashboard.enrolledClasses,(function(t,e){return s("Class",{key:t.id+e,attrs:{buddhaClass:t}})})),t.dashboard.newClasses.length?s("h2",[t._v("学会最新课程")]):t._e(),t._l(t.dashboard.newClasses,(function(t,e){return s("Class",{key:t.id+e,attrs:{buddhaClass:t,forApplication:!0}})}))],2)}),r=[],c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("h3",{domProps:{textContent:t._s(t.buddhaClass.name)}}),s("h4",[t._v("\n    辅导员："+t._s(t.teachers)+" 师兄  \n    "),s("a",{attrs:{href:t.buddhaClass.url,target:"_blank"}},[t._v("学习资料网页")])]),t.buddhaClass.classSnapshot?s("div",[s("b-table",{attrs:{striped:"",hover:"",items:t.items,"thead-class":"hidden_header"}})],1):t._e(),t.forApplication?s("div",[s("b-button",{attrs:{block:"",variant:"info"},on:{click:t.listSession}},[t._v("查看详情")]),s("hr")],1):s("div",[s("div",[s("h4",[t._v("正在闻思")]),0===t.buddhaClass.classSessions.length?s("div",[t._v("\n        还没有开课，敬请期待！\n      ")]):t._e(),t._l(t.buddhaClass.classSessions,(function(e,n){return s("ClassSession",{key:e.id+n,attrs:{classSession:e,sessionDetails:t.buddhaClass.sessionDetails[n],forApplication:t.forApplication,forAdmin:void 0!=t.buddhaClass.classSnapshot}})})),s("b-button",{attrs:{block:"",variant:"info"},on:{click:t.listSession}},[t._v("查看详情")]),s("hr"),t.buddhaClass.practices.length>0?s("h4",[t._v("正在实修")]):t._e(),t._l(t.buddhaClass.practices,(function(e,n){return s("Practice",{key:e.id+n,attrs:{practice:e,latestPracticeCount:t.buddhaClass.counts[n],practiceSubmodules:t.buddhaClass.practiceSubmodules[n],forAdmin:void 0!=t.buddhaClass.classSnapshot}})}))],2)])])},d=[],l=s("2c634"),u=s("569a"),p=s("2f62");function h(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function b(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?h(Object(s),!0).forEach((function(e){Object(a["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):h(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var m={name:"Class",components:{ClassSession:l["a"],Practice:u["a"]},props:{buddhaClass:{type:Object,required:!0},forApplication:Boolean},data:function(){return{teachers:this.buddhaClass.teachers.join(),items:this.buddhaClass.classSnapshot?[{key:"学生人数",value:this.buddhaClass.classSnapshot.studentCount},{key:"已计划上课",value:this.buddhaClass.classSnapshot.sessionScheduled},{key:" 已完成上课",value:this.buddhaClass.classSnapshot.sessionCompleted}]:[]}},computed:b({},Object(p["b"])(["isClassAdmin","isTeachingAssistant"])),methods:{listSession:function(){this.$router.push({name:"session-management",params:{classId:this.buddhaClass.id,forApplication:this.forApplication,forAdmin:void 0!=this.buddhaClass.classSnapshot,loadingNewSessions:this.isClassAdmin||this.isTeachingAssistant}})}}},f=m,v=(s("60b6"),s("2877")),g=Object(v["a"])(f,c,d,!1,null,null,null),S=g.exports,O={name:"StudentDashboard",props:{dashboard:{type:Object,required:!0}},components:{Class:S}},D=O,y=Object(v["a"])(D,i,r,!1,null,null,null),w=y.exports,A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"user-preview"},[0===t.dashboard.classes.length?s("div",{staticClass:"user-preview"},[t._v("\n    没有找到任何佛学课程！\n  ")]):t._l(t.dashboard.classes,(function(t,e){return s("Class",{key:t.id+e,attrs:{buddhaClass:t}})}))],2)},C=[],_={name:"AdminDashboard",props:{dashboard:{type:Object,required:!0}},components:{Class:S}},k=_,j=Object(v["a"])(k,A,C,!1,null,null,null),I=j.exports,x=s("6c33"),P=s("4360");function L(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function $(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?L(Object(s),!0).forEach((function(e){Object(a["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):L(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var T={name:"Home",components:{StudentDashboard:w,AdminDashboard:I},methods:{studentDashboardTitle:function(){return"".concat(this.currentUser.name,"的闻思修")},classAdminDashboardTitle:function(){return"".concat(this.currentUser.name).concat(this.isStudent?"管理":"辅导","的课程")}},computed:$({},Object(p["b"])(["home","currentUser","isLoadingDashboards","isSystemAdmin","isStudent"])),beforeRouteEnter:function(t,e,s){console.log("from: ".concat(e.path)),e&&e.path&&e.path.startsWith("/home")?s():P["a"].dispatch(x["c"]).then((function(){s()}))}},E=T,U=(s("cccb"),Object(v["a"])(E,n,o,!1,null,null,null));e["default"]=U.exports},c87c:function(t,e,s){},cccb:function(t,e,s){"use strict";var n=s("d563"),o=s.n(n);o.a},d563:function(t,e,s){},f559:function(t,e,s){"use strict";var n=s("5ca1"),o=s("9def"),a=s("d2c8"),i="startsWith",r=""[i];n(n.P+n.F*s("5147")(i),"String",{startsWith:function(t){var e=a(this,t,i),s=o(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),n=String(t);return r?r.call(e,n,s):e.slice(s,s+n.length)===n}})}}]);
//# sourceMappingURL=chunk-9a8d2fe4.8d4a2534.js.map