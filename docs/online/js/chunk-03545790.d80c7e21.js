(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03545790"],{"2c634":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.editing?s("b-form",{on:{submit:t.onSubmit,reset:t.onReset}},[s("h4",[t._v(t._s(t.session.name?t.session.name:"创建新课"))]),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"选择日期："}},[s("v-date-picker",{attrs:{locale:"zh-CN","input-props":{readonly:!0}},model:{value:t.session.scheduledAt,callback:function(e){t.$set(t.session,"scheduledAt",e)},expression:"session.scheduledAt"}}),s("b-input-group-append",[t.session.creating?t._e():s("b-button",{attrs:{type:"reset",variant:"warning"}},[s("b-icon",{attrs:{icon:"x-circle"}})],1),s("b-button",{attrs:{type:"submit",variant:"success"}},[s("b-icon",{attrs:{icon:"check-circle"}})],1)],1)],1),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"选择课程："}},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.session.id,expression:"session.id"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.session,"id",e.target.multiple?s:s[0])}}},t._l(t.sessionDropdownOptions,(function(e){return s("option",{key:e.id,domProps:{value:e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])})),0),s("b-input-group-append",[t.session.creating?t._e():s("b-button",{attrs:{type:"reset",variant:"warning"}},[s("b-icon",{attrs:{icon:"x-circle"}})],1)],1)],1),s("b-form-textarea",{attrs:{placeholder:"输入上课通知",rows:"8","max-rows":"20"},model:{value:t.session.description,callback:function(e){t.$set(t.session,"description",e)},expression:"session.description"}})],1):s("b-card",{staticClass:"text-center",attrs:{header:t.session.name}},[s("b-card-text",[s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"上课时间："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.scheduledAtLocalDateTimeString,callback:function(e){t.$set(t.session,"scheduledAtLocalDateTimeString",e)},expression:"session.scheduledAtLocalDateTimeString"}}),s("b-input-group-append",[t.newSessions&&(t.isClassAdmin||t.isTeachingAssistant)?s("b-button",{attrs:{variant:"warning"},on:{click:t.editSession}},[t._v("修改")]):t._e()],1)],1),1==t.sessionDetails.submodules.length?s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"课前学习："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.materialState,callback:function(e){t.$set(t.session,"materialState",e)},expression:"session.materialState"}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"info",href:t.session.url,target:"_blank"}},[s("b-icon",{attrs:{icon:"book"}})],1)],1)],1):t._l(t.sessionDetails.submodules,(function(e,n){return s("div",{key:e.id+n},[s("b-link",{attrs:{href:e.url,target:"_blank"}},[t._v(t._s("("+(n+1)+") "+e.name))]),s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"课前学习："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.materialState,callback:function(e){t.$set(t.session,"materialState",e)},expression:"session.materialState"}}),s("b-input-group-append",[s("b-button",{attrs:{variant:"info",href:e.url,target:"_blank"}},[s("b-icon",{attrs:{icon:"book"}})],1)],1)],1)],1)})),t.session.forApplication?t._e():s("b-input-group",{staticClass:"mt-3",attrs:{prepend:"上课出勤："}},[s("b-form-input",{attrs:{readonly:""},model:{value:t.session.attendanceState,callback:function(e){t.$set(t.session,"attendanceState",e)},expression:"session.attendanceState"}}),s("b-input-group-append",[t.needToShowAttendanceButton()?s("b-button",{attrs:{variant:"warning"},on:{click:function(e){return t.updateAttendance()}}},[t._v(t._s(t.attendanceButtonName()))]):t._e(),s("b-button",{attrs:{variant:"info"},on:{click:function(e){t.session.showDescription=!t.session.showDescription}}},[t.session.showDescription?s("b-icon",{attrs:{icon:"chevron-double-up"}}):s("b-icon",{attrs:{icon:"chevron-double-down"}})],1)],1)],1),t.session.showDescription?s("b-form-textarea",{attrs:{placeholder:"",rows:"3","max-rows":"8",readonly:""},model:{value:t.session.description,callback:function(e){t.$set(t.session,"description",e)},expression:"session.description"}}):t._e()],2)],1)],1)},a=[],i=(s("8e6e"),s("ac6a"),s("456d"),s("6762"),s("2fdb"),s("a481"),s("7f7f"),s("bd86")),o=s("bf48"),r=s.n(o),c=s("2f62"),l=s("6d95");function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function u(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(Object(s),!0).forEach((function(e){Object(i["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var h={name:"ClassSession",props:{classSession:{type:Object,required:!0},sessionDetails:{type:Object,required:!1},classInfo:{type:Object,required:!1},newSessions:{type:Array,required:!1},forApplication:Boolean,forAdmin:Boolean},data:function(){return{session:this.classSession.dummy?{creating:!0,editing:!0}:this.initSession(),sessionDropdownOptions:[],editing:this.classSession.dummy}},computed:u({},Object(c["b"])(["isClassAdmin","isTeachingAssistant","isStudent"])),mounted:function(){this.buildSessionDropdownOptions()},methods:{initSession:function(){return{id:this.classSession.id,forApplication:this.classInfo?this.classInfo.forApplication:this.forApplication,name:this.classSession.get("name"),url:this.sessionDetails.submodules[0].url,description:this.classSession.get("description"),scheduledAt:this.classSession.get("scheduledAt"),scheduledAtLocalDateTimeString:this.toLocalDateTimeString(this.classSession.get("scheduledAt")),showDescription:!1,attendanceState:this.toAttendanceStateString(this.sessionDetails),materialState:this.toMaterialStateString(this.sessionDetails,0)}},buildSessionDropdownOptions:function(){if(this.sessionDropdownOptions=[],this.editing)if(this.classSession.dummy)this.sessionDropdownOptions=this.newSessions;else for(var t={id:this.classSession.id,name:this.classSession.get("name")},e=Object(l["b"])(t.name),s=!1,n=0;n<this.newSessions.length;n++){var a=this.newSessions[n];!s&&Object(l["b"])(a.name)>e&&(this.sessionDropdownOptions.push(t),s=!0),this.sessionDropdownOptions.push(a)}},toLocalDateTimeString:function(t){var e={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString("zh-CN",e)},toLocalDateString:function(t){var e={year:"numeric",month:"short",day:"numeric"};return t.toLocaleDateString("zh-CN",e)},needToShowAttendanceButton:function(){return this.isStudent&&!this.forAdmin&&!this.forApplication},toAttendanceStateString:function(t){if(t){if("number"==typeof t.attendance.attendance)return"".concat(t.attendance.attendance,"人已上课");if(t.attendance.onLeave)return"已请假";if(1==t.attendance.attendance)return"已上课";if(0==t.attendance.attendance&&void 0==t.attendance.onLeave)return"未上课"}return"未报考勤"},toMaterialStateString:function(t,e){if(this.forApplication)return"请在课前看完传承/法本";var s="未看传承",n="未看法本";if(t&&t.submodules[e].studyRecord){var a=t.submodules[e].studyRecord;"number"==typeof a.lineage?s="".concat(a.lineage,"人已看传承"):a.lineage&&(s="已看传承"),"number"==typeof a.textbook?n="".concat(a.textbook,"人已看法本"):a.textbook&&(n="已看法本")}return"".concat(s,"/").concat(n)},addToGoogleCalendarUrl:function(){var t=this.session.scheduledAt,e=new Date;e.setTime(t.getTime()+144e5),t=t.toISOString().replace(/.000/g,"").replace(/:/g,"").replace(/-/g,""),e=e.toISOString().replace(/.000/g,"").replace(/:/g,"").replace(/-/g,"");var s="".concat(this.session.name,"&details=").concat(this.session.description);return s=encodeURI(s),"https://www.google.com/calendar/render?action=TEMPLATE&text=".concat(s,"&dates=").concat(t,"%2F").concat(e)},attendanceButtonName:function(){var t=new Date;return t<this.classSession.get("scheduledAt")?this.sessionDetails.attendance.onLeave?"取消请假":"我要请假":void 0!=this.sessionDetails.attendance.attendance?"我要改考勤":"我要报考勤"},updateAttendance:function(){var t=new Date,e="确认",s=this.sessionDetails.attendance;t<this.classSession.get("scheduledAt")?s.onLeave?(s.onLeave=!1,e+="取消请假"):(s.onLeave=!0,s.attendance=!1,e+="请假"):s.attendance?(s.attendance=!1,e+="没有上课"):(s.attendance=!0,e+="已上课");var n=this.classSession.id,a={okText:"确认",cancelText:"取消",loader:!0},i={title:this.session.name,body:e+"?"},o=this;this.$dialog.confirm(i,a).then((function(t){r.a.Cloud.run("home:updateAttendanceV2",{sessionId:n,attendance:s}).then((function(e){console.log("updateAttendanceV2 - result: ".concat(JSON.stringify(e))),void 0!=e.attendance.onLeave&&(o.sessionDetails.attendance.onLeave=e.attendance.onLeave),void 0!=e.attendance.attendance&&(o.sessionDetails.attendance.attendance=e.attendance.attendance),o.session.attendanceState=o.toAttendanceStateString(o.sessionDetails),t.close()})).catch((function(e){console.log("error in updateAttendanceV2: ".concat(e)),t.close(),o.$dialog.alert("error in updateAttendance: ".concat(e))}))})).catch((function(t){console.log("error: ".concat(t))}))},editSession:function(){this.session=this.initSession(),this.editing=!0,this.buildSessionDropdownOptions()},onReset:function(t){t.preventDefault(),this.editing=!1},onSubmit:function(t){t.preventDefault();var e=this.session.id;console.log("sessionId: ".concat(e));var s=this.classInfo.classSessions.filter((function(t){return t.id===e}))[0],n={okText:"确认",cancelText:"取消",loader:!0},a={title:this.classInfo.name,body:"".concat(this.session.creating?"创建新课":"修改"," 《").concat(s.get("name"),"》 @ ").concat(this.toLocalDateString(this.session.scheduledAt),"？")},i=this.session;i.oldId=this.classSession.id;var o=new Date(i.scheduledAt);o.setHours(s.get("url").includes("rpsxl")?9:14),i.scheduledAt=o;var c=this;this.$dialog.confirm(a,n).then((function(t){r.a.Cloud.run("class:updateClassSession",{session:i}).then((function(e){console.log("updateClassSession - result: ".concat(JSON.stringify(e))),t.close(),window.location.reload()})).catch((function(e){console.log("error in updateClassSession: ".concat(JSON.stringify(e))),t.close(),c.$dialog.alert("error in updateClassSession: ".concat(e))}))})).catch((function(t){console.log("error: ".concat(t))}))}}},p=h,b=s("2877"),f=Object(b["a"])(p,n,a,!1,null,null,null);e["a"]=f.exports},"60b6":function(t,e,s){"use strict";var n=s("c87c"),a=s.n(n);a.a},a481:function(t,e,s){"use strict";var n=s("cb7c"),a=s("4bf8"),i=s("9def"),o=s("4588"),r=s("0390"),c=s("5f1b"),l=Math.max,d=Math.min,u=Math.floor,h=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g,b=function(t){return void 0===t?t:String(t)};s("214f")("replace",2,(function(t,e,s,f){return[function(n,a){var i=t(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,i,a):s.call(String(i),n,a)},function(t,e){var a=f(s,t,this,e);if(a.done)return a.value;var u=n(t),h=String(this),p="function"===typeof e;p||(e=String(e));var v=u.global;if(v){var g=u.unicode;u.lastIndex=0}var S=[];while(1){var y=c(u,h);if(null===y)break;if(S.push(y),!v)break;var O=String(y[0]);""===O&&(u.lastIndex=r(h,i(u.lastIndex),g))}for(var D="",w=0,A=0;A<S.length;A++){y=S[A];for(var C=String(y[0]),_=l(d(o(y.index),h.length),0),j=[],k=1;k<y.length;k++)j.push(b(y[k]));var x=y.groups;if(p){var P=[C].concat(j,_,h);void 0!==x&&P.push(x);var T=String(e.apply(void 0,P))}else T=m(C,h,_,j,x,e);_>=w&&(D+=h.slice(w,_)+T,w=_+C.length)}return D+h.slice(w)}];function m(t,e,n,i,o,r){var c=n+t.length,l=i.length,d=p;return void 0!==o&&(o=a(o),d=h),s.call(r,d,(function(s,a){var r;switch(a.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,n);case"'":return e.slice(c);case"<":r=o[a.slice(1,-1)];break;default:var d=+a;if(0===d)return s;if(d>l){var h=u(d/10);return 0===h?s:h<=l?void 0===i[h-1]?a.charAt(1):i[h-1]+a.charAt(1):s}r=i[d-1]}return void 0===r?"":r}))}}))},bb51:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isLoadingDashboards?s("div",[t._v("\n    正在获取主页数据...\n  ")]):s("div",[s("b-tabs",{attrs:{pills:"","content-class":"mt-3",align:"center"}},[t.home.studentDashboard?s("b-tab",{attrs:{title:t.studentDashboardTitle(),"title-item-class":"mytab",acitve:""}},[s("StudentDashboard",{attrs:{dashboard:t.home.studentDashboard}})],1):t._e(),t.home.classAdminDashboard?s("b-tab",{attrs:{title:t.classAdminDashboardTitle(),"title-item-class":"mytab",acitve:""}},[s("AdminDashboard",{attrs:{dashboard:t.home.classAdminDashboard}})],1):t._e(),t.home.systemAdminDashboard?s("b-tab",{attrs:{title:"学会全部课程","title-item-class":"mytab",acitve:""}},[s("AdminDashboard",{attrs:{dashboard:t.home.systemAdminDashboard}})],1):t._e()],1)],1)])},a=[],i=(s("8e6e"),s("ac6a"),s("456d"),s("f559"),s("bd86")),o=(s("7f7f"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"user-preview"},[0===t.dashboard.enrolledClasses.length?s("div",{staticClass:"user-preview"},[t._v("\n    您还没有参加任何佛学课程！\n  ")]):t._l(t.dashboard.enrolledClasses,(function(t,e){return s("Class",{key:t.id+e,attrs:{buddhaClass:t}})})),t.dashboard.newClasses.length?s("h2",[t._v("学会最新课程")]):t._e(),t._l(t.dashboard.newClasses,(function(t,e){return s("Class",{key:t.id+e,attrs:{buddhaClass:t,forApplication:!0}})}))],2)}),r=[],c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("h3",{domProps:{textContent:t._s(t.buddhaClass.name)}}),s("h4",[t._v("\n    辅导员："+t._s(t.teachers)+" 师兄  \n    "),s("a",{attrs:{href:t.buddhaClass.url,target:"_blank"}},[t._v("学习资料网页")])]),t.buddhaClass.classSnapshot?s("div",[s("b-table",{attrs:{striped:"",hover:"",items:t.items,"thead-class":"hidden_header"}})],1):t._e(),t.forApplication?s("div",[s("b-button",{attrs:{block:"",variant:"info"},on:{click:t.listSession}},[t._v("查看详情")]),s("hr")],1):s("div",[s("div",[s("h4",[t._v("正在闻思")]),0===t.buddhaClass.classSessions.length?s("div",[t._v("\n        还没有开课，敬请期待！\n      ")]):t._e(),t._l(t.buddhaClass.classSessions,(function(e,n){return s("ClassSession",{key:e.id+n,attrs:{classSession:e,sessionDetails:t.buddhaClass.sessionDetails[n],forApplication:t.forApplication,forAdmin:void 0!=t.buddhaClass.classSnapshot}})})),s("b-button",{attrs:{block:"",variant:"info"},on:{click:t.listSession}},[t._v("查看详情")]),s("hr"),t.buddhaClass.practices.length>0?s("h4",[t._v("正在实修")]):t._e(),t._l(t.buddhaClass.practices,(function(e,n){return s("Practice",{key:e.id+n,attrs:{practice:e,latestPracticeCount:t.buddhaClass.counts[n],practiceSubmodules:t.buddhaClass.practiceSubmodules[n],forAdmin:void 0!=t.buddhaClass.classSnapshot}})}))],2)])])},l=[],d=s("2c634"),u=s("569a"),h=s("2f62");function p(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function b(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?p(Object(s),!0).forEach((function(e){Object(i["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):p(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var f={name:"Class",components:{ClassSession:d["a"],Practice:u["a"]},props:{buddhaClass:{type:Object,required:!0},forApplication:Boolean},data:function(){return{teachers:this.buddhaClass.teachers.join(),items:this.buddhaClass.classSnapshot?[{key:"学生人数",value:this.buddhaClass.classSnapshot.studentCount},{key:"已计划上课",value:this.buddhaClass.classSnapshot.sessionScheduled},{key:" 已完成上课",value:this.buddhaClass.classSnapshot.sessionCompleted}]:[]}},computed:b({},Object(h["b"])(["isClassAdmin","isTeachingAssistant"])),methods:{listSession:function(){this.$router.push({name:"session-management",params:{classId:this.buddhaClass.id,forApplication:this.forApplication,forAdmin:void 0!=this.buddhaClass.classSnapshot,loadingNewSessions:this.isClassAdmin||this.isTeachingAssistant}})}}},m=f,v=(s("60b6"),s("2877")),g=Object(v["a"])(m,c,l,!1,null,null,null),S=g.exports,y={name:"StudentDashboard",props:{dashboard:{type:Object,required:!0}},components:{Class:S}},O=y,D=Object(v["a"])(O,o,r,!1,null,null,null),w=D.exports,A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"user-preview"},[0===t.dashboard.classes.length?s("div",{staticClass:"user-preview"},[t._v("\n    没有找到任何佛学课程！\n  ")]):t._l(t.dashboard.classes,(function(t,e){return s("Class",{key:t.id+e,attrs:{buddhaClass:t}})}))],2)},C=[],_={name:"AdminDashboard",props:{dashboard:{type:Object,required:!0}},components:{Class:S}},j=_,k=Object(v["a"])(j,A,C,!1,null,null,null),x=k.exports,P=s("6c33"),T=s("4360");function $(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function L(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?$(Object(s),!0).forEach((function(e){Object(i["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var I={name:"Home",components:{StudentDashboard:w,AdminDashboard:x},methods:{studentDashboardTitle:function(){return"".concat(this.currentUser.name,"的闻思修")},classAdminDashboardTitle:function(){return"".concat(this.currentUser.name,"辅导的课程")}},computed:L({},Object(h["b"])(["home","currentUser","isLoadingDashboards","isSystemAdmin"])),beforeRouteEnter:function(t,e,s){console.log("from: ".concat(e.path)),e&&e.path&&e.path.startsWith("/home")?s():T["a"].dispatch(P["c"]).then((function(){s()}))}},E=I,N=(s("cccb"),Object(v["a"])(E,n,a,!1,null,null,null));e["default"]=N.exports},c87c:function(t,e,s){},cccb:function(t,e,s){"use strict";var n=s("d563"),a=s.n(n);a.a},d563:function(t,e,s){},f559:function(t,e,s){"use strict";var n=s("5ca1"),a=s("9def"),i=s("d2c8"),o="startsWith",r=""[o];n(n.P+n.F*s("5147")(o),"String",{startsWith:function(t){var e=i(this,t,o),s=a(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),n=String(t);return r?r.call(e,n,s):e.slice(s,s+n.length)===n}})}}]);
//# sourceMappingURL=chunk-03545790.d80c7e21.js.map